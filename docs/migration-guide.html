<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Migration Guide - Sigma Thermal Engineering</title>
    <link rel="stylesheet" href="css/docs.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-brand">Sigma Thermal Engineering</div>
            <div class="nav-links">
                <a href="index.html" class="nav-link">Home</a>
                <a href="resources.html" class="nav-link">Resources</a>
                <a href="progress.html" class="nav-link">Progress</a>
                <a href="migration-guide.html" class="nav-link active">Migration Guide</a>
                <a href="test-results.html" class="nav-link">Test Results</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <header class="page-header">
            <h1>VBA to Python Migration Guide</h1>
            <p class="subtitle">Step-by-step guide to replace Excel VBA macros with Python UDFs</p>
        </header>

        <section class="card">
            <h2>Overview</h2>
            <p>This guide walks you through replacing your existing VBA macro functions with the new Python-powered UDFs. The Python functions provide the same calculations with improved accuracy and maintainability.</p>
            
            <div class="features">
                <h3>Migration Benefits</h3>
                <ul>
                    <li><strong>Better Accuracy</strong> - Validated against ASME standards (&lt;0.5% deviation)</li>
                    <li><strong>Cross-platform</strong> - Works on Windows and macOS</li>
                    <li><strong>Maintainable</strong> - Text-based code in version control</li>
                    <li><strong>Tested</strong> - 412 automated unit tests</li>
                    <li><strong>Documented</strong> - Comprehensive function reference</li>
                </ul>
            </div>
        </section>

        <section class="card">
            <h2>Quick Start (5 Minutes)</h2>
            
            <h3>1. Install xlwings</h3>
            <div class="code-block">
pip install xlwings
xlwings addin install
xlwings addin status  # Should show "installed"
            </div>

            <h3>2. Copy Files</h3>
            <p>Copy these files to the same directory as your Excel workbook:</p>
            <ul>
                <li><code>excel_udf/sigma_thermal_udf.py</code></li>
                <li><code>excel_udf/xlwings.conf</code></li>
            </ul>

            <h3>3. Import in Excel</h3>
            <ol>
                <li>Open your workbook</li>
                <li>Go to xlwings ribbon tab</li>
                <li>Click "Import Functions"</li>
                <li>Enter: <code>sigma_thermal_udf</code></li>
            </ol>

            <h3>4. Replace Function Names</h3>
            <p>Use Find & Replace (Ctrl+H) to convert VBA to Python:</p>
            <div class="code-block">
Find: =HHVMass(              Replace: =HHV_MASS_GAS(
Find: =SaturationPressure(   Replace: =SATURATION_PRESSURE(
Find: =WaterDensity(         Replace: =WATER_DENSITY(
            </div>
        </section>

        <section class="card">
            <h2>Function Mapping</h2>
            
            <h3>Heating Value Functions</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Old VBA Macro</th>
                        <th>New Python UDF</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>=HHVMass(...)</td><td>=HHV_MASS_GAS(...)</td></tr>
                    <tr><td>=LHVMass(...)</td><td>=LHV_MASS_GAS(...)</td></tr>
                    <tr><td>=HHVVolume(...)</td><td>=HHV_VOLUME_GAS(...)</td></tr>
                    <tr><td>=LHVVolume(...)</td><td>=LHV_VOLUME_GAS(...)</td></tr>
                </tbody>
            </table>

            <h3>Steam Properties Functions</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Old VBA Macro</th>
                        <th>New Python UDF</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>=SaturationPressure(T)</td><td>=SATURATION_PRESSURE(T)</td></tr>
                    <tr><td>=SaturationTemp(P)</td><td>=SATURATION_TEMPERATURE(P)</td></tr>
                    <tr><td>=SteamEnthalpy(T, P, x)</td><td>=STEAM_ENTHALPY(T, P, x)</td></tr>
                    <tr><td>=SteamQuality(h, P)</td><td>=STEAM_QUALITY(h, P)</td></tr>
                </tbody>
            </table>

            <h3>Water Properties Functions</h3>
            <table class="table">
                <thead>
                    <tr>
                        <th>Old VBA Macro</th>
                        <th>New Python UDF</th>
                    </tr>
                </thead>
                <tbody>
                    <tr><td>=WaterDensity(T)</td><td>=WATER_DENSITY(T)</td></tr>
                    <tr><td>=WaterViscosity(T)</td><td>=WATER_VISCOSITY(T)</td></tr>
                    <tr><td>=WaterCp(T)</td><td>=WATER_SPECIFIC_HEAT(T)</td></tr>
                    <tr><td>=WaterK(T)</td><td>=WATER_THERMAL_CONDUCTIVITY(T)</td></tr>
                </tbody>
            </table>
        </section>

        <section class="card">
            <h2>Migration Strategies</h2>
            
            <h3>Option A: Side-by-Side Comparison (Recommended)</h3>
            <ol>
                <li>Keep VBA macros active temporarily</li>
                <li>Add new column next to each calculation</li>
                <li>Compare results (should match within 0.5%)</li>
                <li>Once validated, replace VBA formulas</li>
            </ol>

            <h3>Option B: Direct Replacement</h3>
            <ol>
                <li>Backup your workbook</li>
                <li>Use Find & Replace to change function names</li>
                <li>Verify calculations</li>
                <li>Remove VBA code</li>
            </ol>

            <h3>Option C: Gradual Migration</h3>
            <ol>
                <li>Migrate one worksheet at a time</li>
                <li>Test thoroughly after each sheet</li>
                <li>Keep VBA as fallback</li>
                <li>Complete migration when confident</li>
            </ol>
        </section>

        <section class="card">
            <h2>Troubleshooting</h2>
            
            <h3>#NAME? Error</h3>
            <p><strong>Cause:</strong> Excel cannot find the function</p>
            <p><strong>Solution:</strong></p>
            <ul>
                <li>Verify xlwings add-in is enabled</li>
                <li>Re-import functions (xlwings tab → Import Functions)</li>
                <li>Restart Excel</li>
            </ul>

            <h3>#VALUE! Error</h3>
            <p><strong>Cause:</strong> Invalid input values</p>
            <p><strong>Solution:</strong></p>
            <ul>
                <li>Check inputs are numbers (not text)</li>
                <li>Verify fuel composition sums to 100%</li>
                <li>Check units (°F for temp, psia for pressure)</li>
            </ul>

            <h3>Slow First Calculation</h3>
            <p><strong>Cause:</strong> Python startup overhead</p>
            <p><strong>Solution:</strong></p>
            <ul>
                <li>This is normal (2-5 seconds first time)</li>
                <li>Subsequent calculations are fast</li>
                <li>Use Manual calculation mode for large sheets</li>
            </ul>

            <h3>Results Differ from VBA</h3>
            <p><strong>Cause:</strong> Improved calculation methods</p>
            <p><strong>Solution:</strong></p>
            <ul>
                <li>Python uses updated correlations (more accurate)</li>
                <li>Differences &lt;0.5% are expected and acceptable</li>
                <li>Python results validated against ASME standards</li>
            </ul>
        </section>

        <section class="card">
            <h2>Migration Checklist</h2>
            
            <div class="code-block">
☐ Backup original Excel workbook
☐ Install Python dependencies (pip install xlwings)
☐ Install xlwings add-in (xlwings addin install)
☐ Copy sigma_thermal_udf.py to workbook directory
☐ Copy xlwings.conf to workbook directory
☐ Enable xlwings add-in in Excel
☐ Import UDF module (xlwings ribbon)
☐ Test Python UDFs in empty cells
☐ Create side-by-side comparison (VBA vs Python)
☐ Validate Python results match VBA (within tolerance)
☐ Replace all VBA formulas with Python UDFs
☐ Export/backup VBA code
☐ Remove VBA modules from workbook
☐ Save workbook as .xlsx (non-macro format)
☐ Test all calculations after migration
☐ Verify workbook performance
☐ Document any differences or issues
☐ Archive old macro-enabled workbook
            </div>
        </section>

        <section class="card">
            <h2>Next Steps</h2>
            
            <h3>After Migration</h3>
            <ul>
                <li><strong>Test thoroughly</strong> - Verify all calculations work correctly</li>
                <li><strong>Document changes</strong> - Note any differences in results</li>
                <li><strong>Train users</strong> - Show team how to use new functions</li>
                <li><strong>Archive VBA code</strong> - Keep backup for reference</li>
            </ul>

            <h3>Additional Resources</h3>
            <ul>
                <li><a href="excel-udf/function-reference.md">Complete Function Reference</a></li>
                <li><a href="excel-udf/quick-reference.md">Quick Reference Sheet</a></li>
                <li><a href="test-results.html">Validation Test Results</a></li>
                <li><a href="resources.html">Technical Resources</a></li>
            </ul>
        </section>

        <section class="card">
            <h2>Example Migration</h2>
            
            <h3>Before (VBA):</h3>
            <div class="code-block">
A1: 85     (CH4 %)
B1: 10     (C2H6 %)
C1: 3      (C3H8 %)
D1: 1      (C4H10 %)
E1: 1      (CO2 %)

F1: =HHVMass(A1, B1, C1, D1, 0, 0, 0, E1, 0)
    Result: 23389.33 BTU/lb (VBA)
            </div>

            <h3>After (Python):</h3>
            <div class="code-block">
A1: 85     (CH4 %)
B1: 10     (C2H6 %)
C1: 3      (C3H8 %)
D1: 1      (C4H10 %)
E1: 1      (CO2 %)

F1: =HHV_MASS_GAS(A1, B1, C1, D1, 0, 0, 0, E1, 0)
    Result: 23389.33 BTU/lb (Python)
    
Validation: ✓ Results match within 0.01%
            </div>
        </section>
    </div>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2025 GTS Energy Inc. All rights reserved.</p>
            <p>Version 1.0.0 | Python 3.11+ | Excel 2016+</p>
        </div>
    </footer>
</body>
</html>
